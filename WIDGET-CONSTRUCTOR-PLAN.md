# План разработки: Конструктор простых виджетов

> **Статус:** В разработке
> **Создан:** 2026-02-04
> **Последнее обновление:** 2026-02-05

---

## Оглавление

1. [Обзор проекта](#обзор-проекта)
2. [Фаза 1: Дизайны виджетов](#фаза-1-дизайны-виджетов)
3. [Фаза 2: Конструктор виджета](#фаза-2-конструктор-виджета)
4. [Фаза 3: Backend и интеграции](#фаза-3-backend-и-интеграции)
5. [Технические требования](#технические-требования)
6. [Чеклист готовности](#чеклист-готовности)

---

## Краткая инструкция по работе

### Навигация

| Что | URL | Описание |
|-----|-----|----------|
| Галерея дизайнов | `http://localhost:3000/widget-preview` | Список всех 5 дизайнов с карточками |
| Liquid Glass | `http://localhost:3000/widget-preview/design-1-liquid-glass` | Превью дизайна 1 |
| Neomorphism | `http://localhost:3000/widget-preview/design-2-neomorphism` | Превью дизайна 2 |
| Minimalism | `http://localhost:3000/widget-preview/design-3-minimalism` | Превью дизайна 3 |
| Abstract | `http://localhost:3000/widget-preview/design-4-abstract` | Превью дизайна 4 |
| Modern | `http://localhost:3000/widget-preview/design-5-modern` | Превью дизайна 5 |
| **Песочница** | `http://localhost:3000/widget-preview/sandbox` | Тестирование новых дизайнов |

### Песочницы (Sandbox)

5 песочниц для разработки и тестирования дизайнов:

| Sandbox | URL | Статус |
|---------|-----|--------|
| sandbox-1-plasma | `/widget-preview/sandbox-1-plasma` | В работе (плазма) |
| sandbox-2 | `/widget-preview/sandbox-2` | Пусто |
| sandbox-3 | `/widget-preview/sandbox-3` | Пусто |
| sandbox-4 | `/widget-preview/sandbox-4` | Пусто |
| sandbox-5 | `/widget-preview/sandbox-5` | Пусто |

**Путь:** `apps/web/src/app/(marketing)/widget-preview/sandbox-X/`

**Workflow:**
1. Выбираешь свободный sandbox
2. Кладёшь код в `source/` или референс в `references/`
3. Итерируем пока не понравится
4. Переносим готовый дизайн в `design-X`

### Как добавлять материалы для дизайна

**Путь к папкам:** `apps/web/src/app/(marketing)/widget-preview/design-X-название/`

| Папка/Файл | Что класть | Форматы |
|------------|------------|---------|
| `references/` | Скриншоты, мокапы, вдохновение | PNG, JPG, GIF, Figma ссылки |
| `source/` | Готовый код для переделки | HTML, CSS, JS файлы |
| `notes.md` | Заметки, комментарии, ТЗ | Markdown |
| `page.tsx` | Рабочий код превью | React/TypeScript |

### Процесс работы над дизайном

1. **Подготовка** — кладёшь референсы в `references/`, код в `source/`
2. **Сообщаешь мне** — "Посмотри design-1, добавил референс"
3. **Я обновляю** — редактирую `page.tsx` под референс
4. **Проверяешь** — смотришь на localhost, даёшь фидбек
5. **Итерации** — повторяем пока не утвердим
6. **Утверждение** — отмечаем статус "Утверждён" в `notes.md`

### Что уже готово в каждом превью

- Переключатель формы кнопки (круг / квадрат / blob)
- Переключатель анимации (вертикальная / горизонтальная / радиальная)
- Интерактивная кнопка виджета с раскрытием
- 4 иконки соцсетей (WhatsApp, Telegram, VK, сообщение)
- Переключатель темы (где применимо)
- Панель с заметками по дизайну

### Команды

```bash
# Запуск сервера
pnpm dev

# Или только web приложение
pnpm --filter web dev
```

### Простой виджет vs Умный виджет

Один и тот же дизайн кнопки и раскрытие мессенджеров используются в обоих виджетах. Умный виджет добавляет поверх:

| Компонент | Простой | Умный |
|-----------|---------|-------|
| Кнопка виджета | да | да (общая) |
| Раскрытие мессенджеров | да | да (общее) |
| Проактивный пузырь ("Привет!") | нет | да |
| Окно чата с AI | нет | да |
| Уведомления | нет | да |

**Как это влияет на sandbox:** каждый sandbox содержит два набора компонентов:

```
sandbox-1-plasma/
├── page.tsx                 # Переключатель режима: [Простой] [Умный]
├── plasma.css               # Стили кнопки (общие)
├── simple/                  # Компоненты простого виджета
│   └── SocialExpand.tsx     # Раскрытие с мессенджерами
└── smart/                   # Компоненты умного виджета
    ├── ChatWindow.tsx       # Окно чата
    ├── ProactiveBubble.tsx  # Всплывающий пузырь
    ├── MessageList.tsx      # Список сообщений
    └── smart.css            # Стили умного виджета
```

Переключатель позволяет видеть как один и тот же дизайн кнопки смотрится в обоих режимах — цвета, анимации и пузыри должны быть согласованы.

**Как говорить со мной о компонентах:**
- "Поменяй окно чата" → `smart/ChatWindow.tsx`
- "Поменяй раскрытие мессенджеров" → `simple/SocialExpand.tsx`
- "Поменяй кнопку" → `plasma.css` (общее для обоих режимов)

### Интеграция с бекендом AI (Илья)

Бекенд Ильи — это отдельный API. Нам не важно на каком языке он написан (Python, Node, и т.д.) — мы просто отправляем запросы и рисуем ответы. Контракт, который нужно согласовать с Ильёй:

| Что | Пример |
|-----|--------|
| URL эндпоинта | `https://api.floqly.ru/ai/chat` |
| Формат запроса | `{ message: "...", widget_id: "..." }` |
| Формат ответа | `{ reply: "...", typing: true/false }` |
| Транспорт | WebSocket (real-time) или REST (обычный HTTP) |

До согласования с Ильёй — работаем над UI чата с моковыми данными.

---

## Обзор проекта

### Что делаем

Бесплатный конструктор простых виджетов для сайтов — кнопка связи с раскрывающимся меню социальных сетей и формой обратной связи.

### Ценность для пользователя

- Быстрая установка на любой сайт (Tilda, Wix, WordPress и др.)
- 5 уникальных дизайнов на выбор
- Кастомизация цветов, иконок, анимаций
- Бесплатный базовый функционал
- Аналитика кликов в личном кабинете

### Путь пользователя

1. Заходит на страницу конструктора
2. Выбирает дизайн, настраивает параметры
3. Видит превью в реальном времени
4. Копирует код для вставки
5. **Регистрируется** для сохранения настроек и аналитики
6. Управляет виджетом из личного кабинета

---

## Фаза 1: Дизайны виджетов

### Структура папок

```
apps/web/src/app/(marketing)/widget-preview/
├── page.tsx                    # Главная страница со списком дизайнов
├── design-1-liquid-glass/
│   ├── page.tsx                # Страница превью (СОЗДАНА)
│   ├── references/             # Референсы (изображения)
│   ├── source/                 # Исходный код (если есть)
│   └── notes.md                # Заметки по дизайну
├── design-2-neomorphism/
│   ├── page.tsx                # (СОЗДАНА)
│   ├── references/
│   ├── source/
│   └── notes.md
├── design-3-minimalism/
│   ├── page.tsx                # (СОЗДАНА)
│   ├── references/
│   ├── source/
│   └── notes.md
├── design-4-abstract/
│   ├── page.tsx                # (СОЗДАНА)
│   ├── references/
│   ├── source/
│   └── notes.md
└── design-5-modern/
    ├── page.tsx                # (СОЗДАНА)
    ├── references/
    ├── source/
    └── notes.md
```

### URL-адреса для превью

| Дизайн | URL |
|--------|-----|
| Список всех | `/widget-preview` |
| Liquid Glass | `/widget-preview/design-1-liquid-glass` |
| Neomorphism | `/widget-preview/design-2-neomorphism` |
| Minimalism | `/widget-preview/design-3-minimalism` |
| Abstract | `/widget-preview/design-4-abstract` |
| Modern | `/widget-preview/design-5-modern` |

### 5 дизайнов

| # | Название | Стиль | Источник | Статус |
|---|----------|-------|----------|--------|
| 1 | **Liquid Glass** | Стеклянный, размытие, прозрачность | Референс/код | ⬜ Не начат |
| 2 | **Neomorphism** | Мягкие тени, вдавленность | Референс/код | ⬜ Не начат |
| 3 | **Minimalism** | Чистый, простой, контрастный | Совместно | ⬜ Не начат |
| 4 | **Abstract** | Градиенты, формы, креатив | Совместно | ⬜ Не начат |
| 5 | **Modern** | Современный, трендовый | Референс/код | ⬜ Не начат |

### Компоненты каждого дизайна

Для каждого из 5 дизайнов нужно реализовать:

#### 1. Кнопка виджета
- [ ] Форма: круг
- [ ] Форма: квадрат со скруглением
- [ ] Форма: асимметрия
- [ ] Hover-эффект
- [ ] Анимация появления

#### 2. Раскрытие меню
- [ ] Вертикальное раскрытие (вверх/вниз)
- [ ] Горизонтальное раскрытие (влево/вправо)
- [ ] Радиальное раскрытие (полукругом)

#### 3. Иконки социальных сетей
- [ ] WhatsApp
- [ ] Telegram
- [ ] VK
- [ ] Instagram (опционально)
- [ ] Viber
- [ ] Email
- [ ] Телефон
- [ ] Кастомная ссылка

#### 4. Кнопка "Написать онлайн"
- [ ] Дизайн кнопки
- [ ] Форма сообщения (имя, сообщение)
- [ ] Анимация отправки
- [ ] Состояние успеха

#### 5. Опционально: Кнопка "Наверх"
- [ ] В том же стиле что и основная кнопка
- [ ] Позиция над основной кнопкой
- [ ] Плавный скролл наверх

#### 6. Адаптивность темы
- [ ] Светлая тема
- [ ] Тёмная тема
- [ ] Автоопределение темы сайта (`prefers-color-scheme`)

---

## Фаза 2: Конструктор виджета

### Страница конструктора

**URL:** `/simple-widget` или `/widget-constructor`

### Секции настроек

#### 1. Выбор дизайна
- Карточки с превью 5 дизайнов
- При клике — применяется к превью

#### 2. Форма кнопки
- Круг
- Квадрат со скруглением
- Асимметрия (blob)

#### 3. Анимация раскрытия
- Вертикальная
- Горизонтальная
- Радиальная

#### 4. Позиция на экране
- Правый нижний угол (по умолчанию)
- Левый нижний угол
- Правый/левый край по центру

#### 5. Цветовая схема
- Основной цвет кнопки
- Цвет иконок
- Цвет фона меню
- Пресеты цветов

#### 6. Социальные сети
- Включение/выключение каждой сети
- Ввод ссылок/номеров
- Порядок отображения (drag & drop)

#### 7. Кнопка "Написать онлайн"
- Включить/выключить
- Текст кнопки
- Placeholder для формы

#### 8. Кнопка "Наверх"
- Включить/выключить
- Позиция относительно основной кнопки

#### 9. Настройки появления
- Задержка появления (секунды)
- Появление при скролле (% страницы)

#### 10. Тема
- Только светлая
- Только тёмная
- Автоопределение

### Превью в реальном времени

- Справа от настроек (desktop)
- Снизу (mobile)
- Интерактивное — можно кликать и тестировать

### Генерация кода

```html
<!-- Floqly Widget -->
<script src="https://cdn.floqly.ru/widget/simple.js"
        data-widget-id="abc123"
        defer></script>
```

---

## Фаза 3: Backend и интеграции

### API эндпоинты

```
POST   /api/simple-widget          # Создать виджет
GET    /api/simple-widget/:id      # Получить настройки
PUT    /api/simple-widget/:id      # Обновить настройки
DELETE /api/simple-widget/:id      # Удалить виджет
POST   /api/simple-widget/:id/message  # Отправить сообщение
GET    /api/simple-widget/:id/stats    # Статистика кликов
```

### База данных (Supabase)

```sql
-- Таблица виджетов
CREATE TABLE simple_widgets (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  design VARCHAR(50) NOT NULL,
  shape VARCHAR(20) NOT NULL,
  animation VARCHAR(20) NOT NULL,
  position VARCHAR(20) DEFAULT 'bottom-right',
  primary_color VARCHAR(7),
  icon_color VARCHAR(7),
  bg_color VARCHAR(7),
  social_links JSONB,
  online_chat_enabled BOOLEAN DEFAULT true,
  scroll_top_enabled BOOLEAN DEFAULT false,
  appearance_delay INTEGER DEFAULT 0,
  theme_mode VARCHAR(20) DEFAULT 'auto',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Таблица сообщений
CREATE TABLE widget_messages (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  widget_id UUID REFERENCES simple_widgets(id),
  name VARCHAR(100),
  message TEXT NOT NULL,
  page_url TEXT,
  user_agent TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  is_read BOOLEAN DEFAULT false
);

-- Таблица статистики
CREATE TABLE widget_stats (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  widget_id UUID REFERENCES simple_widgets(id),
  event_type VARCHAR(50), -- 'click', 'expand', 'social_click', 'message_sent'
  event_data JSONB,
  page_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Личный кабинет

- Раздел "Простые виджеты" в дашборде
- Список созданных виджетов
- Редактирование каждого виджета
- Диалоги (входящие сообщения)
- Статистика по кликам

---

## Технические требования

### Виджет (apps/widget)

- **Размер бандла:** < 50kb gzipped
- **Изоляция:** Shadow DOM
- **Совместимость:** iframe (Tilda, Wix)
- **Именование:** нейтральное (`fl-helper.js`)
- **Загрузка:** `defer` или `async`

### Безопасность

- CORS только для разрешённых доменов
- Rate limiting на API
- Валидация входных данных
- XSS-защита в сообщениях

### Производительность

- Ленивая загрузка иконок
- Минимум HTTP-запросов
- Кэширование настроек

---

## Чеклист готовности

### Фаза 1: Дизайны

- [ ] Design 1: Liquid Glass — утверждён
- [ ] Design 2: Neomorphism — утверждён
- [ ] Design 3: Minimalism — утверждён
- [ ] Design 4: Abstract — утверждён
- [ ] Design 5: Modern — утверждён

### Фаза 2: Конструктор

- [ ] UI конструктора готов
- [ ] Превью работает в реальном времени
- [ ] Все настройки функционируют
- [ ] Генерация кода работает
- [ ] Интеграция с авторизацией

### Фаза 3: Backend

- [ ] API эндпоинты готовы
- [ ] База данных настроена
- [ ] Виджет загружается и работает
- [ ] Статистика собирается
- [ ] Сообщения приходят в ЛК

### Финал

- [ ] Тестирование на разных сайтах
- [ ] Документация для пользователей
- [ ] Деплой на production

---

## Заметки

> Здесь можно добавлять заметки по ходу разработки

### 2026-02-05
- Создан план разработки
- Определены 5 дизайнов: Liquid Glass, Neomorphism, Minimalism, Abstract, Modern
- Создана структура папок для всех дизайнов
- Созданы базовые страницы превью для всех 5 дизайнов
- Создана главная страница галереи `/widget-preview`
- Добавлена инструкция по работе
- Создана страница-песочница (sandbox) для тестирования новых дизайнов
- Реорганизованы sandbox-ы: 5 штук с workflow (sandbox-1-plasma в работе)
- Зафиксирована архитектура simple/smart: общая кнопка + `simple/` и `smart/` папки внутри sandbox
- Добавлен раздел про интеграцию с AI-бекендом Ильи (контракт API)
