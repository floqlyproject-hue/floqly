# Embed-—Å–∏—Å—Ç–µ–º–∞ Floqly ‚Äî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

> **–î–ª—è –∫–æ–≥–æ:** –ù–∏–∫–∏—Ç–∞ (–≤–ª–∞–¥–µ–ª–µ—Ü), –ò–ª—å—è (–ø–∞—Ä—Ç–Ω—ë—Ä, AI backend)
> **–ö–æ–≥–¥–∞:** –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ embed-—Å–∏—Å—Ç–µ–º—ã (—Å–ª–µ–¥—É—é—â–∞—è —Å–µ—Å—Å–∏—è —Å Claude)
> **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω:** `C:\Users\User\.claude\plans\misty-sparking-gem.md` + –∫–æ–ø–∏—è `docs/plans/PLAN-embed-system.md`

---

## –ß—Ç–æ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

Embed-—Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –≤—Å—Ç–∞–≤–∏—Ç—å **–æ–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–≤–æ–π —Å–∞–π—Ç** ‚Äî –∏ –≤–∏–¥–∂–µ—Ç Floqly –Ω–∞—á–Ω—ë—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –ë–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞, –±–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ‚Äî —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª –∫–æ–¥ –∏–∑ –õ–ö –∏ –≤—Å—Ç–∞–≤–∏–ª.

### –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

```html
<!-- Cookie –±–∞–Ω–Ω–µ—Ä -->
<script src="https://floqly.ru/embed/fl-helper.iife.js" data-widget-id="a1b2c3d4"></script>

<!-- –í–∏–¥–∂–µ—Ç —á–∞—Ç–∞ (simple ‚Üí smart –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) -->
<script src="https://floqly.ru/embed/fl-helper.iife.js" data-widget-id="x7y8z9w0"></script>
```

- –ö–∞–∂–¥—ã–π –≤–∏–¥–∂–µ—Ç ‚Äî **–æ—Ç–¥–µ–ª—å–Ω—ã–π script —Ç–µ–≥** —Å–æ —Å–≤–æ–∏–º `data-widget-id`
- `fl-helper.iife.js` ‚Äî –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–∏–¥–∂–µ—Ç–æ–≤
- `data-widget-id` ‚Äî —ç—Ç–æ `embed_key` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `widgets` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π 16-—Å–∏–º–≤–æ–ª—å–Ω—ã–π hex)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

| –†–µ—à–µ–Ω–∏–µ | –ü–æ—á–µ–º—É |
|---------|--------|
| **Per-widget embed** (–∫–∞–∂–¥—ã–π –≤–∏–¥–∂–µ—Ç ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–¥) | –ò–∑–æ–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫, –º–µ–Ω—å—à–∏–π bundle, –ª–µ–≥—á–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ |
| **Simple ‚Üí Smart upgrade** | –¢–∏–ø –≤–∏–¥–∂–µ—Ç–∞ (`type`) –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ‚Äî –∫–ª–∏–µ–Ω—Ç –ù–ï —Ç—Ä–æ–≥–∞–µ—Ç –∫–æ–¥ –Ω–∞ —Å–∞–π—Ç–µ |
| **–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π** | –í—Å—è —Ä–∞–±–æ—Ç–∞ —Å Supabase —á–µ—Ä–µ–∑ `embed-service.ts` ‚Äî –ø—Ä–∏ —Å–º–µ–Ω–µ –ë–î –º–µ–Ω—è–µ–º –æ–¥–∏–Ω —Ñ–∞–π–ª |
| **Shadow DOM** | –ö–∞–∂–¥—ã–π –≤–∏–¥–∂–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω ‚Äî CSS/JS –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç –º–µ–∂–¥—É —Å–æ–±–æ–π –∏ —Å —Å–∞–π—Ç–æ–º –∫–ª–∏–µ–Ω—Ç–∞ |

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞ TimeWeb

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Docker-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|----------|
| `VITE_API_URL` | `https://floqly.ru` | URL –¥–ª—è –≤–∏–¥–∂–µ—Ç-—Å–∫—Ä–∏–ø—Ç–∞ (–∫—É–¥–∞ —Å–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã) |

–û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`, `NODE_ENV`) ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã.

### 2. –î–µ–ø–ª–æ–π

**–ù–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.** Push –≤ `main` ‚Üí TimeWeb –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–æ–±–∏—Ä–∞–µ—Ç Docker image (widget build ‚Üí Next.js build ‚Üí standalone)
2. –î–µ–ø–ª–æ–∏—Ç –Ω–∞ floqly.ru

---

## DNS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–∞ –±—É–¥—É—â–µ–µ)

–°–µ–π—á–∞—Å —Å–∫—Ä–∏–ø—Ç –æ—Ç–¥–∞—ë—Ç—Å—è —Å `floqly.ru/embed/fl-helper.iife.js` ‚Äî —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

–ö–æ–≥–¥–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –≤—ã—Ä–∞—Å—Ç–µ—Ç –∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è CDN:
1. –°–æ–∑–¥–∞—Ç—å CNAME –∑–∞–ø–∏—Å—å: `cdn.floqly.ru` ‚Üí target CDN (Cloudflare, BunnyCDN)
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å `fl-helper.iife.js` –Ω–∞ CDN
3. –û–±–Ω–æ–≤–∏—Ç—å URL –≤ embed-–∫–æ–¥–µ

**–ü–æ–∫–∞ CDN –Ω–µ –Ω—É–∂–µ–Ω** ‚Äî Next.js –æ—Ç–¥–∞—ë—Ç static —Ñ–∞–π–ª—ã —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º (`Cache-Control: public, max-age=3600`).

---

## Supabase ‚Äî —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

–ï—Å–ª–∏ Supabase –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ `001_initial_schema.sql`, —Ç–æ –≤—Å—ë —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

- [ ] SQL —Ñ—É–Ω–∫—Ü–∏—è `increment_widget_views(widget_uuid UUID)` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] SQL —Ñ—É–Ω–∫—Ü–∏—è `increment_widget_interactions(widget_uuid UUID)` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] RLS policy "Anyone can view active widgets by embed_key" ‚Äî –≤–∫–ª—é—á–µ–Ω–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `widgets`
- [ ] RLS policy "Anyone can create analytics events" ‚Äî –≤–∫–ª—é—á–µ–Ω–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `analytics_events`
- [ ] –ò–Ω–¥–µ–∫—Å `idx_widgets_embed_key` –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `widgets`

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** Supabase Dashboard ‚Üí SQL Editor ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```sql
SELECT routine_name FROM information_schema.routines
WHERE routine_name IN ('increment_widget_views', 'increment_widget_interactions');
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
```
curl -I https://floqly.ru/embed/fl-helper.iife.js
```
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: `200 OK`, `Content-Type: application/javascript`

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
```
curl https://floqly.ru/api/v1/embed/{embed_key}
```
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: JSON —Å –∫–æ–Ω—Ñ–∏–≥–æ–º –≤–∏–¥–∂–µ—Ç–∞

### –®–∞–≥ 3: –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `test.html`:
```html
<!DOCTYPE html>
<html>
<head><title>Floqly Test</title></head>
<body>
  <h1>–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h1>
  <p>Cookie –±–∞–Ω–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤–Ω–∏–∑—É</p>

  <script src="https://floqly.ru/embed/fl-helper.iife.js"
          data-widget-id="–í–°–¢–ê–í–ò–¢–¨_EMBED_KEY_–°–Æ–î–ê"></script>
</body>
</html>
```
–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Üí cookie –±–∞–Ω–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è.

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –ù–∞–∂–∞—Ç—å ¬´–ü—Ä–∏–Ω—è—Ç—å¬ª –Ω–∞ –±–∞–Ω–Ω–µ—Ä–µ
- –ó–∞–π—Ç–∏ –≤ Supabase ‚Üí Table Editor ‚Üí `analytics_events` ‚Üí –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å
- –ó–∞–π—Ç–∏ –≤ –õ–ö Floqly ‚Üí ProjectCard ‚Üí —Å—á—ë—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –¥–æ–ª–∂–µ–Ω —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è

---

## –î–ª—è –ò–ª—å–∏ ‚Äî –Ω—é–∞–Ω—Å—ã –∏ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

```
–°–∞–π—Ç –∫–ª–∏–µ–Ω—Ç–∞                    floqly.ru (Next.js)                 Supabase
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
<script data-widget-id="abc">
    ‚îÇ
    ‚îú‚îÄ GET /api/v1/embed/abc ‚îÄ‚îÄ‚ñ∫ EmbedService.getWidgetConfig() ‚îÄ‚îÄ‚ñ∫ widgets table
    ‚îÇ                              ‚îÇ                                  (embed_key=abc)
    ‚îÇ  ‚óÑ‚îÄ‚îÄ { type, config } ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îú‚îÄ –†–µ–Ω–¥–µ—Ä –≤–∏–¥–∂–µ—Ç–∞ (Shadow DOM)
    ‚îÇ
    ‚îî‚îÄ POST /api/v1/embed/events ‚ñ∫ EmbedService.recordEvent() ‚îÄ‚îÄ‚ñ∫ analytics_events
```

### –¢–æ—á–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Smart Widget (AI —á–∞—Ç)

–ö–æ–≥–¥–∞ –¥–æ–π–¥—ë–º –¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Smart Widget, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:

**1. –ù–æ–≤—ã–π API endpoint:** `POST /api/v1/chat/message`
```typescript
// Request –æ—Ç –≤–∏–¥–∂–µ—Ç–∞:
{
  widget_id: "uuid",
  conversation_id: "uuid",
  message: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É —É–∑–Ω–∞—Ç—å –æ —Ü–µ–Ω–∞—Ö",
  visitor_id: "anon_abc123",
  context: {
    page_url: "https://client-site.ru/prices",
    referrer: "https://google.com",
    // ... –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  }
}

// Response –æ—Ç Python AI:
{
  response: "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –†–∞–¥ –ø–æ–º–æ—á—å...",
  metadata: {
    model: "gpt-4",
    tokens: 150,
    intent: "pricing_inquiry"
  }
}
```

**2. Next.js –∫–∞–∫ –ø—Ä–æ–∫—Å–∏:** –í–∏–¥–∂–µ—Ç ‚Üí Next.js API ‚Üí Python —Å–µ—Ä–≤–∏—Å –ò–ª—å–∏ ‚Üí –æ–±—Ä–∞—Ç–Ω–æ.
- Next.js –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (knowledge_base, conversation history)
- Python —Å–µ—Ä–≤–∏—Å –¥–µ–ª–∞–µ—Ç inference
- –û—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤–∏–¥–∂–µ—Ç—É

**3. Streaming (–∫–æ–≥–¥–∞ AI "–ø–µ—á–∞—Ç–∞–µ—Ç"):** SSE –∏–ª–∏ WebSocket
- –í–∏–¥–∂–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç EventSource –∫ `/api/v1/chat/stream`
- Next.js –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –æ—Ç Python —Å–µ—Ä–≤–∏—Å–∞

### –ß—Ç–æ –ò–ª—å—è –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å (–∫–æ–≥–¥–∞ –¥–æ–π–¥—ë–º –¥–æ Smart Widget):
- URL –µ–≥–æ Python —Å–µ—Ä–≤–∏—Å–∞ (–¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è)
- –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞ (—Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ streaming (SSE preferred)

### Per-widget vs Project-wide ‚Äî —Ä–µ—à–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–∏–º–æ

**–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ:** –∫–∞–∂–¥—ã–π –≤–∏–¥–∂–µ—Ç ‚Äî —Å–≤–æ–π `<script data-widget-id="...">`.

**–ï—Å–ª–∏ –ò–ª—å—è –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –æ–¥–∏–Ω –∫–æ–¥ –Ω–∞ –ø—Ä–æ–µ–∫—Ç:**
–ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å **2 —Ñ–∞–π–ª–∞** (–Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É):
1. `apps/widget/src/main.ts` ‚Äî —á–∏—Ç–∞—Ç—å `data-project-id`, –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –≤–∏–¥–∂–µ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
2. –î–æ–±–∞–≤–∏—Ç—å endpoint `GET /api/v1/embed/project/{projectId}` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –≤–∏–¥–∂–µ—Ç–æ–≤

–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π —É–∂–µ –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥ `getWidgetsByProject()` ‚Äî –æ–Ω –≥–æ—Ç–æ–≤.

**–ì–∏–±—Ä–∏–¥–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:** –º–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –û–ë–ê –ø–æ–¥—Ö–æ–¥–∞:
```html
<!-- Per-widget (—Ç–µ–∫—É—â–∏–π) -->
<script data-widget-id="abc123">

<!-- Project-wide (–¥–æ–±–∞–≤–∏—Ç—å) -->
<script data-project-id="project-uuid">
```
–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –µ—Å—Ç—å `data-widget-id`? ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç –æ–¥–∏–Ω. –ï—Å—Ç—å `data-project-id`? ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ.

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å Supabase –Ω–∞ –¥—Ä—É–≥—É—é –ë–î

–í–µ—Å—å –∫–æ–¥ —Ä–∞–±–æ—Ç—ã —Å Supabase –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –≤ **–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ:**
```
apps/web/src/lib/services/embed-service.ts
```

–ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:
1. –ú–µ–Ω—è–µ–º `embed-service.ts` ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ–º –Ω–æ–≤—É—é –ë–î (Postgres –Ω–∞–ø—Ä—è–º—É—é, Prisma, Drizzle, etc.)
2. –ú–µ–Ω—è–µ–º `lib/supabase/` ‚Üí `lib/db/` ‚Äî –Ω–æ–≤—ã–π DB client
3. Auth: —Å Supabase Auth ‚Üí NextAuth –∏–ª–∏ custom JWT
4. API endpoints –∏ –≤–∏–¥–∂–µ—Ç-—Å–∫—Ä–∏–ø—Ç **–ù–ï –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è**

---

## –ò–¥–µ–∏ –Ω–∞ –±—É–¥—É—â–µ–µ (–æ—Ç–º–µ—á–µ–Ω—ã, –Ω–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è —Å–µ–π—á–∞—Å)

### üí° –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
–ö–æ–≥–¥–∞ —É –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–∂–µ—Ç–æ–≤ ‚Üí –≤ –õ–ö –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è drag-and-drop –ø—Ä–µ–≤—å—é, –≥–¥–µ –º–æ–∂–Ω–æ —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å –≤–∏–¥–∂–µ—Ç—ã –ø–æ —ç–∫—Ä–∞–Ω—É. –î–∞–Ω–Ω—ã–µ —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —ç—Ç–æ (`config.position`).

### üìä –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Floqly
–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –î–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `analytics_events` ‚Äî –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ UI. –ù–∞ –ø–µ—Ä–≤–æ–µ –≤—Ä–µ–º—è –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ Supabase Table Editor.

### üåç CDN –¥–ª—è —Å–∫—Ä–∏–ø—Ç–∞
–ö–æ–≥–¥–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –≤—ã—Ä–∞—Å—Ç–µ—Ç ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–∞–∑–¥–∞—á—É `fl-helper.iife.js` –Ω–∞ CDN (Cloudflare/BunnyCDN). –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: `cdn.floqly.ru` CNAME.

---

## –ì–¥–µ —á—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è

| –ß—Ç–æ | –ì–¥–µ |
|-----|-----|
| –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω (–¥–ª—è Claude) | `C:\Users\User\.claude\plans\misty-sparking-gem.md` |
| –ö–æ–ø–∏—è –ø–ª–∞–Ω–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ | `docs/plans/PLAN-embed-system.md` |
| –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç | `docs/plans/PLAN-embed-system-setup.md` |
| –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–µ–∫—Ç–∞ | `docs/PROGRESS.md` |
